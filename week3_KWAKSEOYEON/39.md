# 39장 DOM

DOM은 **HTML 문서의 계층적 구조와 정보를 표현**하며 이를 제어할 수 있는 API , 즉 프로퍼티와 메서드를 제공하는 트리 자료구조다.

→ 자신의 구조와 정보를 제어하는 건 **DOM API**

### 노드

HTML 요소는 렌더링 엔진에 의해 파싱되어 DOM을 구성하는 요소인 노드 객체로 변환된다. HTML 요소의 어트리뷰트는 어트리뷰트 노드로, HTML 요소의 텍스트 노드는 텍스트 노드로 변환된다.

HTML 요소 간 중첩 관계에 의해 계층적인 부자 관계가 형성된다. → 트리 자료 구조로

트리 자료 구조란 부모 노드와 자식 노드로 구성되어 노드 간 계층적 구조를 표현하는 비선형 자료구조를 말한다.

![image.png](attachment:9e3f4e59-4474-4182-8b1a-9593fcc0b3ac:image.png)

노드 객체는 총 12개의 종류가 있다.

- 문서 노드 : DOM 트리 최상위에 존재하는 루트 노드, document 객체
- 요소 노드
- 어트리뷰트 노드
- 텍스트 노드
- Comment 노드
- DocumentType 노드
- DocumentFragment 노드

DOM을 구성하는 노드 객체는 ECMASciprt 사양에 정의된 표준 빌트인 객체가 아니라 브라우저 한경에서 제공하는 호스트 객체다.

![image.png](attachment:db505897-831f-4dc3-bf9f-13cd4f802107:image.png)

이러한 노드 객체도 자바스크립트 객체이므로 프로토타입에 의한 상속 구조를 갖는다.

### 요소 노드 취득

HTML 구조나 내용 또는 스타일을 동적으로 조작하려면 요소 노드를 먼저 취득해야 한다.

**id를 이용한 요소 노드 취득**

- Document.prototype.getElementById 메서드는 id 어트리뷰트를 갖는 하나의 요소를 탐색한다. 반드시 document를 통해 호출해야 한다. id는 HTML 문서 내에서 유일해야 하며 , 여러 값을 가질 수 없다. 인수로 전달된 첫 번째 요소만 반환한다.

**태그 이름을 이용한 요소 노드 취득**

- Document.prototype/EIement.prototype.getEIementsByTagName 메서드는 인수로 전달한 태그 이름을 갖는 모든 요소 노드들을 탐색하여 반환한다.

**class를 이용한 요소 노드 취득**

- Document.prototype/EIement.prototype.getEIementsByCIassName 메서드는 인수로 전달한 cIas 어트리뷰트값(이하 class 값)을 갖는 모든 요소 노드들을 탐색하여 반환한다.

**CSS 선택자**

CSS 선택자는 HTML 요소를 특정짓는 문법으로, 스타일을 적용하거나 JavaScript로 요소를 선택할 때 사용된다.

`p`, `#id`, `.class`, `div > p`, `a:hover` 등으로 `querySelector`나 `querySelectorAll` 메서드와 함께 사용된다.

**`querySelector` / `querySelectorAll`**

- `querySelector(selector)`: 전달한 CSS 선택자와 일치하는 첫 번째 요소 노드를 반환합니다. 없으면 `null` 반환.
- `querySelectorAll(selector)`: 선택자와 일치하는 모든 요소 노드들을 NodeList로 반환합니다. 없으면 빈 NodeList 반환.

**`.matches()`**

`Element.prototype.matches(selector)` 요소가 특정 CSS 선택자와 일치하는지를 `true` 또는 `false`로 반환한다. 이벤트 위임에서 사용된다.

### 노드 탐색

노드를 취득한 후에는 부모, 자식, 형제 노드 등을 탐색할 수 있다.

**자식 노드 탐색**

- `childNodes`: 모든 자식 노드(NodeList)를 반환 (텍스트 노드 포함).
- `children`: 요소 노드만 반환 (HTMLCollection).
- `firstChild`, `lastChild`: 첫/마지막 자식 노드 반환 (텍스트 노드 포함).
- `firstElementChild`, `lastElementChild`: 첫/마지막 자식 요소 노드 반환.

**부모 노드 탐색**

- `parentNode`: 부모 노드를 반환 (요소 노드 또는 문서 노드).

**형제 노드 탐색**

- `previousSibling`, `nextSibling`: 텍스트 노드 포함 이전/다음 형제 노드 반환.
- `previousElementSibling`, `nextElementSibling`: 요소 노드만 반환.

### 자식 노드 존재 확인

- `hasChildNodes()`: 텍스트 노드 포함 여부 기준으로 자식 노드 존재 여부를 boolean으로 반환.
- `children.length` 또는 `childElementCount`: 요소 노드 기준 자식 존재 여부 확인.

### 공백 텍스트 노드 주의

- 줄바꿈, 탭, 스페이스 등은 텍스트 노드로 인식되어 `childNodes`에 포함됨.
- 레이아웃에 영향을 주지 않지만 탐색 시 실수의 원인이 될 수 있으므로 주의.

### 노드 정보 확인

- `nodeType`: 노드 종류를 숫자로 반환 (1: 요소, 3: 텍스트, 9: 문서 등).
- `nodeName`: 노드 이름을 문자열로 반환 (예: `DIV`, `#text`, `#document` 등).

### 요소 노드의 텍스트 조작

**nodeValue**

- 텍스트 노드에 대해서만 의미 있으며, getter와 setter를 제공.
- 요소 노드의 텍스트를 변경하려면 해당 요소의 첫 번째 자식 텍스트 노드를 찾아 `nodeValue`를 수정.

**textContent**

- 요소 노드의 모든 텍스트를 가져오거나 변경할 수 있다.
- getter: HTML 마크업을 무시하고 텍스트만 반환.
- setter: 기존 자식 노드를 제거하고 문자열을 텍스트로 추가.
- `innerText`보다 빠르고 일관된 결과를 제공.

**innerHTML**

- 요소 노드의 콘텐츠 영역에 포함된 HTML 마크업을 문자열로 가져오거나 설정할 수 있다.
- setter 사용 시 기존 모든 자식 노드가 제거되고 새로 파싱되어 추가된다.
- XSS 공격에 취약할 수 있으므로 사용자 입력값에는 반드시 Sanitization 필요 (예: DOMPurify 사용).

**insertAdjacentHTML(position, html)**

- `beforebegin`, `afterbegin`, `beforeend`, `afterend` 중 하나의 위치를 지정하여 새로운 HTML을 삽입.
- 기존 요소를 제거하지 않고 삽입 가능하며, `innerHTML`보다 효율적이다.

### DOM 조작 (노드 직접 생성 및 추가)

**요소 노드 생성**

- `document.createElement(tagName)`으로 새 요소 노드를 생성 (DOM에는 아직 추가되지 않음).

**텍스트 노드 생성**

- `document.createTextNode(text)`로 텍스트 노드를 생성.

**노드 추가**

- `appendChild(node)`: 마지막 자식 노드로 추가.
- `insertBefore(newNode, referenceNode)`: 특정 자식 노드 앞에 새 노드 삽입.

**DocumentFragment 사용**

- 여러 노드를 한 번에 추가할 때 성능 최적화를 위해 사용.
- `createDocumentFragment()`로 생성 후 자식 노드들을 추가, 마지막에 한 번만 DOM에 삽입.

**노드 이동**

- DOM에 이미 존재하는 노드를 `appendChild`, `insertBefore` 등으로 다른 위치로 이동 가능.

**노드 복사**

- `cloneNode(deep)`로 얕은/깊은 복사 수행.
- deep: true이면 자손 노드까지 포함하여 복사.

**노드 교체**

- `replaceChild(newNode, oldNode)`로 특정 자식 노드를 다른 노드로 교체.

**노드 삭제**

- `removeChild(node)`로 특정 자식 노드를 DOM에서 제거.

### 어트리뷰트 조작

**attributes 프로퍼티**

- 모든 어트리뷰트를 NamedNodeMap 형태로 반환 (읽기 전용).

**getAttribute / setAttribute**

- `getAttribute(attr)`: 초기 상태의 어트리뷰트 값 반환.
- `setAttribute(attr, value)`: 어트리뷰트 값 설정.

**hasAttribute / removeAttribute**

- 존재 확인 및 어트리뷰트 제거.

**DOM 프로퍼티와의 차이**

- `value`, `checked` 등은 사용자 입력에 따라 변하는 최신 상태(DOM 프로퍼티)와 초기 상태(HTML 어트리뷰트)로 나뉜다.
- `id`, `class` 등은 항상 어트리뷰트와 프로퍼티가 동기화됨.

### data-\* 어트리뷰트

- 사용자 정의 데이터를 저장할 수 있는 어트리뷰트.
- `element.dataset`으로 접근. 카멜케이스로 변환됨.
- 값 설정 시 data-\* 어트리뷰트가 자동으로 추가됨.

### 스타일 조작

**style 프로퍼티**

- 인라인 스타일에만 적용. CSSStyleDeclaration 객체 반환.
- 케밥 케이스 CSS 속성은 대괄호 표기법으로 접근.
- 단위가 필요한 속성은 반드시 단위 포함해야 적용됨.

**class 조작**

- `className`: 클래스 전체 문자열을 읽거나 설정.
- `classList`: 클래스를 개별적으로 조작할 수 있는 DOMTokenList 반환.
  - `add`, `remove`, `replace`, `toggle`, `contains`, `item` 등 제공.

**getComputedStyle(element)**

- 요소에 적용된 최종 계산된 스타일(CSSStyleDeclaration)을 반환.
- 인라인, 외부, 기본 스타일 등 모두 포함.
- 의사 요소 스타일은 두 번째 인수로 `::before` 등 지정 가능.
